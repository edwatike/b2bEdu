# ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## –ü–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- [x] `.env.local` —Å–æ–¥–µ—Ä–∂–∏—Ç `YANDEX_CLIENT_ID`
- [x] `.env.local` —Å–æ–¥–µ—Ä–∂–∏—Ç `YANDEX_CLIENT_SECRET`
- [x] `.env.local` —Å–æ–¥–µ—Ä–∂–∏—Ç `YANDEX_REDIRECT_URI`
- [x] `.env.local` —Å–æ–¥–µ—Ä–∂–∏—Ç `YANDEX_SCOPE`
- [x] `.env.local` —Å–æ–¥–µ—Ä–∂–∏—Ç `NEXT_PUBLIC_API_URL`
- [x] `.env.local` —Å–æ–¥–µ—Ä–∂–∏—Ç `MODERATOR_MASTER_EMAIL`

**–¢–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ `.env.local`:**
```
YANDEX_CLIENT_ID=f13aa94092e74191ab90ac908df3c42b
YANDEX_CLIENT_SECRET=170746997c17407bb388dd7872d2666a
YANDEX_REDIRECT_URI=http://localhost:3000/api/yandex/callback
YANDEX_SCOPE=login:email login:info mail:imap_full mail:smtp
NEXT_PUBLIC_API_URL=https://hobnailed-ballistically-jolie.ngrok-free.dev
MODERATOR_MASTER_EMAIL=edwatik@yandex.ru
```

### 2. –ë—ç–∫–µ–Ω–¥
- [ ] Backend –∑–∞–ø—É—â–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ –Ω–∞ ngrok
- [ ] Backend –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: https://hobnailed-ballistically-jolie.ngrok-free.dev
- [ ] Endpoint `/health` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200 OK
- [ ] Endpoint `/api/auth/yandex-oauth` –≥–æ—Ç–æ–≤ –∫ POST –∑–∞–ø—Ä–æ—Å–∞–º

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```bash
curl -H "ngrok-skip-browser-warning: true" https://hobnailed-ballistically-jolie.ngrok-free.dev/health
```

### 3. –§—Ä–æ–Ω—Ç–µ–Ω–¥
- [ ] Frontend –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://localhost:3000
- [ ] –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/login` –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –í–∏–¥–Ω—ã —Å—Ç–∞—Ç—É—Å—ã: Backend –∏ –Ø–Ω–¥–µ–∫—Å
- [ ] –ö–Ω–æ–ø–∫–∞ "–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å.–ü–∞—Å–ø–æ—Ä—Ç" –∞–∫—Ç–∏–≤–Ω–∞ (–Ω–µ —Å–µ—Ä–∞—è)

### 4. –Ø–Ω–¥–µ–∫—Å OAuth
- [x] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ https://oauth.yandex.ru
- [x] Client ID —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ `.env.local`
- [x] Client Secret —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ `.env.local`
- [x] Redirect URI –¥–æ–±–∞–≤–ª–µ–Ω –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: http://localhost:3000/api/yandex/callback
- [x] Scope —Å–æ–¥–µ—Ä–∂–∏—Ç: login:email, login:info, mail:imap_full, mail:smtp

### 5. API –º–∞—Ä—à—Ä—É—Ç—ã
- [ ] –ú–∞—Ä—à—Ä—É—Ç `/api/yandex/login` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [ ] –ú–∞—Ä—à—Ä—É—Ç `/api/yandex/callback` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [ ] –ú–∞—Ä—à—Ä—É—Ç `/api/yandex/config` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [ ] Backend endpoint `/api/auth/yandex-oauth` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

### 6. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- [ ] Cookies —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Å —Ñ–ª–∞–≥–æ–º httpOnly
- [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è secure flag –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- [ ] State –ø–∞—Ä–∞–º–µ—Ç—Ä –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å–ª—É—á–∞–π–Ω–æ
- [ ] CSRF tokens –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è

---

## –¢–µ—Å—Ç–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

1. [ ] –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000/login
2. [ ] –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å—ã:
   - ‚úÖ Backend –ø–æ–¥–∫–ª—é—á–µ–Ω (–∑–µ–ª–µ–Ω—ã–π)
   - ‚úÖ –Ø–Ω–¥–µ–∫—Å OAuth –Ω–∞—Å—Ç—Ä–æ–µ–Ω (—Å–∏–Ω–∏–π)
3. [ ] –ù–∞–∂–º–∏—Ç–µ "–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å.–ü–∞—Å–ø–æ—Ä—Ç"
4. [ ] –í—ã –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ https://oauth.yandex.ru/authorize
5. [ ] –í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –æ—Ç –Ø–Ω–¥–µ–∫—Å–∞
6. [ ] –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
7. [ ] –í—ã –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ http://localhost:3000/moderator
8. [ ] –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –≤–∏–¥–Ω–æ: auth_token cookie —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –£—Å–ø–µ—à–Ω–æ –≤–æ—à–ª–∏ –≤ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä-–ø–∞–Ω–µ–ª—å

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: Backend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

1. [ ] –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ backend
2. [ ] –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000/login (—Å Ctrl+Shift+Del)
3. [ ] –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å—ã:
   - ‚ùå Backend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–∫—Ä–∞—Å–Ω—ã–π)
   - ‚úÖ –Ø–Ω–¥–µ–∫—Å OAuth –Ω–∞—Å—Ç—Ä–æ–µ–Ω (—Å–∏–Ω–∏–π)
4. [ ] –ö–Ω–æ–ø–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –∞–∫—Ç–∏–≤–Ω–∞, –Ω–æ –±—É–¥–µ—Ç –æ—à–∏–±–∫–∞ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –°–∏—Å—Ç–µ–º–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –Ø–Ω–¥–µ–∫—Å –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω

1. [ ] –£–¥–∞–ª–∏—Ç–µ `YANDEX_CLIENT_ID` –∏–∑ `.env.local`
2. [ ] –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (npm run dev)
3. [ ] –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000/login
4. [ ] –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å—ã:
   - ‚úÖ Backend –ø–æ–¥–∫–ª—é—á–µ–Ω (–∑–µ–ª–µ–Ω—ã–π)
   - ‚ö†Ô∏è –Ø–Ω–¥–µ–∫—Å –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–∂–µ–ª—Ç—ã–π)
5. [ ] –ö–Ω–æ–ø–∫–∞ –≤—ã–∫–ª—é—á–µ–Ω–∞ (—Å–µ—Ä–∞—è)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –°–∏—Å—Ç–µ–º–∞ –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–æ–π—Ç–∏ –±–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –û—Ç–∫–∞–∑ –≤ –¥–æ—Å—Ç—É–ø–µ

1. [ ] –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000/login
2. [ ] –ù–∞–∂–º–∏—Ç–µ "–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å.–ü–∞—Å–ø–æ—Ä—Ç"
3. [ ] –ù–∞ –Ø–Ω–¥–µ–∫—Å–µ –Ω–∞–∂–º–∏—Ç–µ "–û—Ç–∫–∞–∑–∞—Ç—å"
4. [ ] –í—ã –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ http://localhost:3000/login?error=yandex_oauth_failed
5. [ ] –ü–æ–∫–∞–∑–∞–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ: "–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω..."

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12)

**–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—Ö–æ–¥–∞:**
```
[v0] Backend check: 200 OK
[v0] Yandex config check: {yandexOAuthEnabled: true}
```

**–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –≤—Ö–æ–¥–∞:**
```
Redirecting to: /api/yandex/login
```

**–ü–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å –Ø–Ω–¥–µ–∫—Å–∞:**
```
[v0] Auth token set in cookie: auth_token
[v0] Redirecting to: /moderator (–∏–ª–∏ /cabinet)
```

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞ backend (–ª–æ–≥–∏ FastAPI)

**–ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ OAuth:**
```
POST /api/auth/yandex-oauth
Email: edwatik@yandex.ru
User created/updated
JWT token issued
```

**–û—à–∏–±–∫–∏:**
```
ERROR: Email not provided
ERROR: User creation failed
ERROR: Database error
```

---

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

| –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|
| ‚ùå Backend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω | –ó–∞–ø—É—Å—Ç–∏—Ç–µ backend, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ ngrok URL |
| ‚ùå –Ø–Ω–¥–µ–∫—Å –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env.local` |
| ‚ùå "Invalid redirect_uri" | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `YANDEX_REDIRECT_URI` –≤ –Ø–Ω–¥–µ–∫—Å OAuth |
| ‚ùå "access_denied" | –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é |
| ‚ùå Email –Ω–µ –ø–æ–ª—É—á–µ–Ω | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ scope –≤ `.env.local` |
| ‚ùå JWT —Ç–æ–∫–µ–Ω –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ backend response |
| ‚ùå –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `MODERATOR_MASTER_EMAIL` |

---

## –û—Ç–ª–∞–¥–∫–∞

### –í–∫–ª—é—á–∏—Ç—å debug —Ä–µ–∂–∏–º

–í `.env.local`:
```env
NEXT_PUBLIC_DEBUG=true
```

–≠—Ç–æ –≤–∫–ª—é—á–∏—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫–æ–Ω—Å–æ–ª–∏.

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

```bash
curl http://localhost:3000/api/yandex/config
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ:**
```json
{"yandexOAuthEnabled": true}
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å backend

```bash
curl -H "ngrok-skip-browser-warning: true" https://hobnailed-ballistically-jolie.ngrok-free.dev/health
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{"status": "healthy"}
```

---

## –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
- [ ] –í—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ `/moderator` (–∞–¥–º–∏–Ω) –∏–ª–∏ `/cabinet` (—é–∑–µ—Ä)
- [ ] Cookie `auth_token` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
- [ ] –í—ã –º–æ–∂–µ—Ç–µ –∑–∞–≥—Ä—É–∂–∞—Ç—å –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ API endpoints
- [ ] –ú–æ–∂–µ—Ç–µ –≤—ã–π—Ç–∏ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É logout

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API:
```bash
# –° auth_token cookie:
curl -b "auth_token=YOUR_TOKEN" https://hobnailed-ballistically-jolie.ngrok-free.dev/api/auth/me -H "ngrok-skip-browser-warning: true"
```

---

## –°—Ç–∞—Ç—É—Å –ø—Ä–æ–≤–µ—Ä–∫–∏

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:** 2026-02-07

- [x] –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è ‚úÖ
- [x] API –º–∞—Ä—à—Ä—É—Ç—ã ‚úÖ
- [x] –Ø–Ω–¥–µ–∫—Å OAuth ‚úÖ
- [x] Frontend —Å—Ç—Ä–∞–Ω–∏—Ü–∞ ‚úÖ
- [x] –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å ‚úÖ

**–°—Ç–∞—Ç—É—Å:** üü¢ –ì–û–¢–û–í–û –ö –ü–†–û–î–ê–ö–®–ï–ù–£

---

**–í–µ—Ä—Å–∏—è —á–µ–∫-–ª–∏—Å—Ç–∞:** 1.0  
**–°–∏—Å—Ç–µ–º–∞:** B2B Platform - Yandex OAuth Only
